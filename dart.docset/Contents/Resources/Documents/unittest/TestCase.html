        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>TestCase class / unittest Library / Dart API Reference</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        <link rel="stylesheet" type="text/css"
            href="../apidoc-styles.css" />
        
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(["_setAccount", "UA-26406144-9"]);
          _gaq.push(["_trackPageview"]);

          (function() {
            var ga = document.createElement("script");
            ga.type = "text/javascript"; ga.async = true;
            ga.src = ("https:" == document.location.protocol ?
              "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(ga, s);
          })();
        </script>
        
        </head>
        <body data-library="unittest" data-type="TestCase">
        <div class="page">
        <div class="header">
          <a href="http://dartlang.org" ref="external"><div class="logo"></div></a>
          <a href="../index.html">Dart API Reference</a>
         &rsaquo; <a href="../unittest.html">unittest</a> &rsaquo; <a href="../unittest/TestCase.html">TestCase</a>        <form action="http://www.dartlang.org/search.html" id="search-box">
          <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
          <input type="hidden" name="ie" value="UTF-8">
          <input type="hidden" name="hl" value="en">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </form>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="../args.html">args</a></h2><h2><div class="icon-library"></div><a href="../crypto.html">crypto</a></h2><h2><div class="icon-library"></div><a href="../dart_async.html">dart:async</a></h2><h2><div class="icon-library"></div><a href="../dart_chrome.html">dart:chrome</a></h2><h2><div class="icon-library"></div><a href="../dart_collection.html">dart:collection</a></h2><h2><div class="icon-library"></div><a href="../dart_core.html">dart:core</a></h2><h2><div class="icon-library"></div><a href="../dart_html.html">dart:html</a></h2><h2><div class="icon-library"></div><a href="../dart_indexed_db.html">dart:indexed_db</a></h2><h2><div class="icon-library"></div><a href="../dart_io.html">dart:io</a></h2><h2><div class="icon-library"></div><a href="../dart_isolate.html">dart:isolate</a></h2><h2><div class="icon-library"></div><a href="../dart_json.html">dart:json</a></h2><h2><div class="icon-library"></div><a href="../dart_math.html">dart:math</a></h2><h2><div class="icon-library"></div><a href="../dart_mirrors.html">dart:mirrors</a></h2><h2><div class="icon-library"></div><a href="../dart_svg.html">dart:svg</a></h2><h2><div class="icon-library"></div><a href="../dart_typed_data.html">dart:typed_data</a></h2><h2><div class="icon-library"></div><a href="../dart_utf.html">dart:utf</a></h2><h2><div class="icon-library"></div><a href="../dart_web_audio.html">dart:web_audio</a></h2><h2><div class="icon-library"></div><a href="../dart_web_gl.html">dart:web_gl</a></h2><h2><div class="icon-library"></div><a href="../dart_web_sql.html">dart:web_sql</a></h2><h2><div class="icon-library"></div><a href="../fixnum.html">fixnum</a></h2><h2><div class="icon-library"></div><a href="../intl.html">intl</a></h2><h2><div class="icon-library"></div><a href="../logging.html">logging</a></h2><h2><div class="icon-library"></div><a href="../matcher.html">matcher</a></h2><h2><div class="icon-library"></div><a href="../mdv_observe.html">mdv_observe</a></h2><h2><div class="icon-library"></div><a href="../meta.html">meta</a></h2><h2><div class="icon-library"></div><a href="../mock.html">mock</a></h2><h2><div class="icon-library"></div><a href="../serialization.html">serialization</a></h2><h2><div class="icon-library"></div><a href="../source_maps.html">source_maps</a></h2><h2><div class="icon-library"></div><a href="../unittest.html">unittest</a></h2><ul class="icon">
<li><a href="../unittest/Configuration.html"><div class="icon-class"></div>Configuration</a></li>
<li><div class="icon-class"></div><strong>TestCase</strong></li>
<li><a href="../unittest/TestFunction.html"><div class="icon-interface"></div>TestFunction</a></li>
</ul>
</div>
<div class="content">
        <h2><strong>TestCase</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>Represents the state for an individual unit test.</p>
<p>Create by calling <a class="crossref" href="../unittest.html#test">test</a> or <a class="crossref" href="../unittest.html#solo_test">solo_test</a>.</p>
<pre class="source">
class TestCase {
 /** Identifier for this test. */
 final int id;

 /** A description of what the test is specifying. */
 final String description;

 /** The setup function to call before the test, if any. */
 Function setUp;

 /** The teardown function to call after the test, if any. */
 Function tearDown;

 /** The body of the test case. */
 TestFunction testFunction;

 /**
  * Remaining number of callbacks functions that must reach a 'done' state
  * to wait for before the test completes.
  */
 int _callbackFunctionsOutstanding = 0;

 String _message = '';
 /** Error or failure message. */
 String get message =&gt; _message;

 String _result;
 /**
  * One of [PASS], [FAIL], [ERROR], or [null] if the test hasn't run yet.
  */
 String get result =&gt; _result;

 String _stackTrace;
 /** Stack trace associated with this test, or [null] if it succeeded. */
 String get stackTrace =&gt; _stackTrace;

 /** The group (or groups) under which this test is running. */
 final String currentGroup;

 DateTime _startTime;
 DateTime get startTime =&gt; _startTime;

 Duration _runningTime;
 Duration get runningTime =&gt; _runningTime;

 bool enabled = true;

 bool _doneTeardown = false;

 Completer _testComplete;

 TestCase._internal(this.id, this.description, this.testFunction)
 : currentGroup = _currentContext.fullName,
   setUp = _currentContext.testSetup,
   tearDown = _currentContext.testTeardown;

 bool get isComplete =&gt; !enabled || result != null;

 void _prepTest() {
   _config.onTestStart(this);
   _startTime = new DateTime.now();
   _runningTime = null;
 }

 Future _runTest() {
   _prepTest();
   // Increment/decrement callbackFunctionsOutstanding to prevent
   // synchronous 'async' callbacks from causing the  test to be
   // marked as complete before the body is completely executed.
   ++_callbackFunctionsOutstanding;
   var f = testFunction();
   --_callbackFunctionsOutstanding;
   if (f is Future) {
     return f.then((_) =&gt; _finishTest())
       .catchError((error) {
         var stack = getAttachedStackTrace(error);
         _registerException(this, error, stack);
       });
   } else {
     _finishTest();
     return null;
   }
 }

 void _finishTest() {
   if (result == null &amp;&amp; _callbackFunctionsOutstanding == 0) {
     pass();
   }
 }

 /**
  * Perform any associated [_setUp] function and run the test. Returns
  * a [Future] that can be used to schedule the next test. If the test runs
  * to completion synchronously, or is disabled, null is returned, to
  * tell unittest to schedule the next test immediately.
  */
 Future _run() {
   if (!enabled) return null;

   _result = _stackTrace = null;
   _message = '';
   _doneTeardown = false;
   var rtn = setUp == null ? null : setUp();
   if (rtn is Future) {
     rtn.then((_) =&gt; _runTest())
        .catchError((e) {
         _prepTest();
         // Calling error() will result in the tearDown being done.
         // One could debate whether tearDown should be done after
         // a failed setUp. There is no right answer, but doing it
         // seems to be the more conservative approach, because
         // unittest will not stop at a test failure.
         var stack = getAttachedStackTrace(e);
         if (stack == null) stack = '';
         error("$description: Test setup failed: $e", "$stack");
       });
   } else {
     var f = _runTest();
     if (f != null) {
       return f;
     }
   }
   if (result == null) { // Not complete.
     _testComplete = new Completer();
     return _testComplete.future;
   }
   return null;
 }

 void _notifyComplete() {
   if (_testComplete != null) {
     _testComplete.complete(this);
     _testComplete = null;
   }
 }

 // Set the results, notify the config, and return true if this
 // is the first time the result is being set.
 void _setResult(String testResult, String messageText, String stack) {
   _message = messageText;
   _stackTrace = _formatStack(stack);
   if (result == null) {
     _result = testResult;
     _config.onTestResult(this);
   } else {
     _result = testResult;
     _config.onTestResultChanged(this);
   }
 }

 void _complete(String testResult,
               [String messageText = '',
                String stack = '']) {
   if (runningTime == null) {
     // The startTime can be `null` if an error happened during setup. In this
     // case we simply report a running time of 0.
     if (startTime != null) {
       _runningTime = new DateTime.now().difference(startTime);
     } else {
       _runningTime = const Duration(seconds: 0);
     }
   }
   _setResult(testResult, messageText, stack);
   if (!_doneTeardown) {
     _doneTeardown = true;
     if (tearDown != null) {
       var rtn = tearDown();
       if (rtn is Future) {
         rtn.then((_) {
           _notifyComplete();
         })
         .catchError((error) {
           var trace = getAttachedStackTrace(error);
           // We don't call fail() as that will potentially result in
           // spurious messages like 'test failed more than once'.
           _setResult(ERROR, "$description: Test teardown failed: ${error}",
               trace == null ? "" : trace.toString());
           _notifyComplete();
         });
         return;
       }
     }
   }
   _notifyComplete();
 }

 void pass() {
   _complete(PASS);
 }

 void fail(String messageText, [String stack = '']) {
   assert(stack != null);
   if (result != null) {
     String newMessage = (result == PASS)
         ? 'Test failed after initially passing: $messageText'
         : 'Test failed more than once: $messageText';
     // TODO(gram): Should we combine the stack with the old one?
     _complete(ERROR, newMessage, stack);
   } else {
     _complete(FAIL, messageText, stack);
   }
 }

 void error(String messageText, [String stack = '']) {
   assert(stack != null);
   _complete(ERROR, messageText, stack);
 }

 void _markCallbackComplete() {
   if (--_callbackFunctionsOutstanding == 0 &amp;&amp; !isComplete) {
     pass();
   }
 }
}
</pre>
</div>
<div>
<h3>Properties</h3>
<div class="field"><h4 id="currentGroup">
<button class="show-code">Code</button>
final <a href="../dart_core/String.html">String</a>         <strong>currentGroup</strong> <a class="anchor-link"
            href="#currentGroup"
            title="Permalink to TestCase.currentGroup">#</a>
        </h4>
        <div class="doc">
<p>The group (or groups) under which this test is running. </p>
<pre class="source">
final String currentGroup
</pre>
</div>
</div>
<div class="field"><h4 id="description">
<button class="show-code">Code</button>
final <a href="../dart_core/String.html">String</a>         <strong>description</strong> <a class="anchor-link"
            href="#description"
            title="Permalink to TestCase.description">#</a>
        </h4>
        <div class="doc">
<p>A description of what the test is specifying. </p>
<pre class="source">
final String description
</pre>
</div>
</div>
<div class="field"><h4 id="enabled">
<button class="show-code">Code</button>
<a href="../dart_core/bool.html">bool</a>         <strong>enabled</strong> <a class="anchor-link"
            href="#enabled"
            title="Permalink to TestCase.enabled">#</a>
        </h4>
        <div class="doc">
<pre class="source">
bool enabled = true
</pre>
</div>
</div>
<div class="field"><h4 id="id">
<button class="show-code">Code</button>
final <a href="../dart_core/int.html">int</a>         <strong>id</strong> <a class="anchor-link"
            href="#id"
            title="Permalink to TestCase.id">#</a>
        </h4>
        <div class="doc">
<p>Identifier for this test. </p>
<pre class="source">
final int id
</pre>
</div>
</div>
<div class="field"><h4 id="isComplete">
<button class="show-code">Code</button>
final <a href="../dart_core/bool.html">bool</a>         <strong>isComplete</strong> <a class="anchor-link"
            href="#isComplete"
            title="Permalink to TestCase.isComplete">#</a>
        </h4>
        <div class="doc">
<pre class="source">
bool get isComplete =&gt; !enabled || result != null;
</pre>
</div>
</div>
<div class="field"><h4 id="message">
<button class="show-code">Code</button>
final <a href="../dart_core/String.html">String</a>         <strong>message</strong> <a class="anchor-link"
            href="#message"
            title="Permalink to TestCase.message">#</a>
        </h4>
        <div class="doc">
<p>Error or failure message. </p>
<pre class="source">
String get message =&gt; _message;
</pre>
</div>
</div>
<div class="field"><h4 id="result">
<button class="show-code">Code</button>
final <a href="../dart_core/String.html">String</a>         <strong>result</strong> <a class="anchor-link"
            href="#result"
            title="Permalink to TestCase.result">#</a>
        </h4>
        <div class="doc">
<p>One of <a class="crossref" href="../unittest.html#PASS">PASS</a>, <a class="crossref" href="../unittest.html#FAIL">FAIL</a>, <a class="crossref" href="../unittest.html#ERROR">ERROR</a>, or <code>null</code> if the test hasn't run yet.</p>
<pre class="source">
String get result =&gt; _result;
</pre>
</div>
</div>
<div class="field"><h4 id="runningTime">
<button class="show-code">Code</button>
final <a href="../dart_core/Duration.html">Duration</a>         <strong>runningTime</strong> <a class="anchor-link"
            href="#runningTime"
            title="Permalink to TestCase.runningTime">#</a>
        </h4>
        <div class="doc">
<pre class="source">
Duration get runningTime =&gt; _runningTime;
</pre>
</div>
</div>
<div class="field"><h4 id="setUp">
<button class="show-code">Code</button>
<a href="../dart_core/Function.html">Function</a>         <strong>setUp</strong> <a class="anchor-link"
            href="#setUp"
            title="Permalink to TestCase.setUp">#</a>
        </h4>
        <div class="doc">
<p>The setup function to call before the test, if any. </p>
<pre class="source">
Function setUp
</pre>
</div>
</div>
<div class="field"><h4 id="stackTrace">
<button class="show-code">Code</button>
final <a href="../dart_core/String.html">String</a>         <strong>stackTrace</strong> <a class="anchor-link"
            href="#stackTrace"
            title="Permalink to TestCase.stackTrace">#</a>
        </h4>
        <div class="doc">
<p>Stack trace associated with this test, or <code>null</code> if it succeeded. </p>
<pre class="source">
String get stackTrace =&gt; _stackTrace;
</pre>
</div>
</div>
<div class="field"><h4 id="startTime">
<button class="show-code">Code</button>
final <a href="../dart_core/DateTime.html">DateTime</a>         <strong>startTime</strong> <a class="anchor-link"
            href="#startTime"
            title="Permalink to TestCase.startTime">#</a>
        </h4>
        <div class="doc">
<pre class="source">
DateTime get startTime =&gt; _startTime;
</pre>
</div>
</div>
<div class="field"><h4 id="tearDown">
<button class="show-code">Code</button>
<a href="../dart_core/Function.html">Function</a>         <strong>tearDown</strong> <a class="anchor-link"
            href="#tearDown"
            title="Permalink to TestCase.tearDown">#</a>
        </h4>
        <div class="doc">
<p>The teardown function to call after the test, if any. </p>
<pre class="source">
Function tearDown
</pre>
</div>
</div>
<div class="field"><h4 id="testFunction">
<button class="show-code">Code</button>
<a href="../unittest/TestFunction.html">TestFunction</a>         <strong>testFunction</strong> <a class="anchor-link"
            href="#testFunction"
            title="Permalink to TestCase.testFunction">#</a>
        </h4>
        <div class="doc">
<p>The body of the test case. </p>
<pre class="source">
TestFunction testFunction
</pre>
</div>
</div>
</div>
<div>
<h3>Methods</h3>
<div class="method"><h4 id="error">
<button class="show-code">Code</button>
void <strong>error</strong>(<a href="../dart_core/String.html">String</a> messageText, [<a href="../dart_core/String.html">String</a> stack = '']) <a class="anchor-link" href="#error"
              title="Permalink to TestCase.error">#</a></h4>
<div class="doc">
<pre class="source">
void error(String messageText, [String stack = '']) {
 assert(stack != null);
 _complete(ERROR, messageText, stack);
}
</pre>
</div>
</div>
<div class="method"><h4 id="fail">
<button class="show-code">Code</button>
void <strong>fail</strong>(<a href="../dart_core/String.html">String</a> messageText, [<a href="../dart_core/String.html">String</a> stack = '']) <a class="anchor-link" href="#fail"
              title="Permalink to TestCase.fail">#</a></h4>
<div class="doc">
<pre class="source">
void fail(String messageText, [String stack = '']) {
 assert(stack != null);
 if (result != null) {
   String newMessage = (result == PASS)
       ? 'Test failed after initially passing: $messageText'
       : 'Test failed more than once: $messageText';
   // TODO(gram): Should we combine the stack with the old one?
   _complete(ERROR, newMessage, stack);
 } else {
   _complete(FAIL, messageText, stack);
 }
}
</pre>
</div>
</div>
<div class="method"><h4 id="pass">
<button class="show-code">Code</button>
void <strong>pass</strong>() <a class="anchor-link" href="#pass"
              title="Permalink to TestCase.pass">#</a></h4>
<div class="doc">
<pre class="source">
void pass() {
 _complete(PASS);
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-06-21 06:35:31.604</div>
<div>        <p>Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>, the content of this
        page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution
        3.0 License</a>, and code samples are licensed under the
        <a href="http://code.google.com/google_bsd_license.html">BSD License</a>.</p>
        <p><a href="http://www.dartlang.org/tos.html">Terms of Service</a> |
        <a href="http://www.google.com/intl/en/privacy/privacy-policy.html">Privacy Policy</a></p>
        </div>
        </div>
        <script async src="../client-static.js"></script>
        </body></html>
        
